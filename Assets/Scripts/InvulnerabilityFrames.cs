using System.Collections;
using System.Collections.Generic;
using Unity.VisualScripting;
using UnityEngine;

public class InvulnerabilityFrames : MonoBehaviour, IOnHitSubscriber
{
    public float duration;
    public int flashCount;
    private SpriteRenderer spriteRenderer;
    private float flashDuration;

    private void Start()
    {
        spriteRenderer = GetComponent<SpriteRenderer>();
        flashDuration = duration / flashCount;
    }

    public void OnHit(OnHitPayload payload)
    {
        var hitbox = GetComponent<Hitbox>();
        hitbox.MakeInvulnerable();

        StartCoroutine(FlashForDuration(hitbox));
    }

    private IEnumerator FlashForDuration(Hitbox hitbox)
    {
        for (int i = 0; i < flashCount; ++i)
        {
            if (spriteRenderer.color == Color.white)
                spriteRenderer.color = Color.red;
            else
                spriteRenderer.color = Color.white;
            yield return new WaitForSeconds(flashDuration);
        }

        spriteRenderer.color = Color.white;
        hitbox.MakeVulnerable();

    }
}
